<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carboidratos: Bioqu√≠mica Interativa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* == Theme Colors for Carbohydrates == */
            --monossacarideo-color: #22c55e;      /* Green for Monosaccharides */
            --dissacarideo-color: #f97316;     /* Orange for Disaccharides */
            --polissacarideo-color: #3b82f6;         /* Blue for Polysaccharides */

            /* Glow/Highlight Colors for light theme */
            --monossacarideo-glow: rgba(34, 197, 94, 0.2);
            --dissacarideo-glow: rgba(249, 115, 22, 0.2);
            --polissacarideo-glow: rgba(59, 130, 246, 0.2);
            
            /* Theme Border Colors for light theme */
            --monossacarideo-border: rgba(34, 197, 94, 0.4);
            --dissacarideo-border: rgba(249, 115, 22, 0.4);
            --polissacarideo-border: rgba(59, 130, 246, 0.4);

            /* Light Theme Palette */
            --bg-main: #f8fafc;
            --text-primary: #1e293b;
            --text-secondary: #475569;
        }

        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Inter', sans-serif; 
            color: var(--text-primary);
            overflow-x: hidden;
            background-color: var(--bg-main);
            transition: background-color 0.5s ease-in-out; /* For quiz feedback */
        }
        
        /* == Background color flash for Quiz == */
        body.correct-bg { background-color: #dcfce7; }
        body.incorrect-bg { background-color: #fee2e2; }

        /* Animated background shapes */
        .background-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            overflow: hidden;
            z-index: -2;
        }
        .light-bubble {
            position: absolute;
            border-radius: 50%;
            filter: blur(140px);
            opacity: 0.15; 
            animation: moveBubble 35s infinite alternate;
        }
        .light-bubble.b1 { width: 45vw; height: 45vw; top: 5%; left: -10%; background: var(--polissacarideo-color); animation-duration: 40s; }
        .light-bubble.b2 { width: 45vw; height: 45vw; top: 40%; left: 70%; background: var(--monossacarideo-color); animation-duration: 35s; }
        .light-bubble.b3 { width: 50vw; height: 50vw; top: 60%; left: 10%; background: var(--dissacarideo-color); animation-duration: 45s; }

        @keyframes moveBubble {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(15vw, -20vh) scale(1.2); }
        }
        
        /* Dynamic background glows for transitions */
        .dynamic-bg-glow {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 150vmax;
            height: 150vmax;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            filter: blur(120px);
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            z-index: -1;
        }
        #bg-definicao-carboidratos { background-color: var(--polissacarideo-color); }
        #bg-monossacarideos { background-color: var(--monossacarideo-color); }
        #bg-di-e-polissacarideos { background-color: var(--dissacarideo-color); }

        .section-container {
            width: 100%;
            padding: 7rem 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }
        
        #hero { 
            min-height: 90vh; 
            padding-top: 2rem; 
            padding-bottom: 2rem;
        }
        #hero h1 { 
            font-size: clamp(2.8rem, 7vw, 5rem); 
            font-weight: 800; 
            letter-spacing: -0.05em; 
            text-shadow: 0 0 20px rgba(0,0,0,0.05);
        }
        #hero p { 
            font-size: clamp(1.1rem, 2.5vw, 1.35rem); 
            max-width: 650px; 
            color: var(--text-secondary);
            margin-left: auto;
            margin-right: auto;
        }

        .section-header-card {
            position: relative;
            background: rgba(255, 255, 255, 0.35);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1.5rem;
            padding: 2.5rem;
            margin-bottom: 3rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 1200px;
            width: 100%;
            overflow: hidden;
            z-index: 2;
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 0.5s ease-out, transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .section-header-card.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .section-header-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: inherit;
            pointer-events: none;
            box-shadow: inset 0 0 0 1.5px rgba(255, 255, 255, 0.6);
            z-index: 1;
        }
        .section-header-card > * {
             position: relative;
             z-index: 2;
        }
        .section-header-card .section-title {
            margin-bottom: 1rem;
        }
        #hero .section-header-card { margin-bottom: 0; } 

        .section-title { font-size: clamp(2.2rem, 5.5vw, 4rem); font-weight: 800; letter-spacing: -0.04em; color: var(--text-primary); position: relative; }
        .section-subtitle { 
            font-size: clamp(1rem, 2vw, 1.2rem); 
            max-width: 700px; 
            color: var(--text-secondary); 
            margin-bottom: 0;
            margin-left: auto; 
            margin-right: auto; 
        }

        .topics-grid {
            width: 100%;
            max-width: 1200px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            align-items: start;
        }

        .topic-card {
            position: relative;
            background: rgba(255, 255, 255, 0.35);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1.5rem;
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
            overflow: hidden;
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 0.5s ease-out, transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .topic-card.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .topic-card:nth-child(1) { transition-delay: 0.05s; }
        .topic-card:nth-child(2) { transition-delay: 0.1s; }
        .topic-card:nth-child(3) { transition-delay: 0.15s; }
        .topic-card:nth-child(4) { transition-delay: 0.2s; }
        .topic-card:nth-child(5) { transition-delay: 0.25s; }


        .topic-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: inherit;
            pointer-events: none;
            box-shadow: inset 0 0 0 1.5px rgba(255, 255, 255, 0.6);
            transition: box-shadow 0.4s ease;
            z-index: 1;
        }
        
        .topic-card:hover::before { 
            box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.8);
        }
        
        .topic-card > div {
            position: relative;
            z-index: 2;
        }

        .topic-card:hover { 
            transform: translateY(-5px);
            border-color: rgba(255, 255, 255, 0.3); 
        }
        
        .topic-card .summary { 
            color: var(--text-primary);
            text-shadow: none;
            font-size: 1.125rem; 
            font-weight: 600; 
            padding: 1.5rem; 
            cursor: pointer; 
            outline: none; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .topic-card .summary::after { 
            content: '+'; 
            font-size: 1.5rem; 
            font-weight: 400; 
            color: var(--text-secondary);
            text-shadow: none;
            transition: transform 0.3s ease-in-out; 
        }
        .topic-card.is-open > .summary::after { transform: rotate(45deg); }
        .topic-card.is-open > .summary { 
            border-bottom: 1px solid rgba(255, 255, 255, 0.2); 
        }
        
        .topic-content-wrapper {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        .topic-content { 
            padding: 1.5rem; 
            font-size: 0.95rem; 
            color: var(--text-secondary);
            text-shadow: none;
        }

        .image-bubble {
            position: relative;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 1.25rem;
            padding: 0.75rem;
            margin-top: 1rem;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .image-bubble:hover {
            transform: scale(1.03);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        
        .image-bubble img {
            width: 100%;
            height: auto;
            border-radius: 0.75rem;
            display: block;
        }
        
        #definicao-carboidratos .topic-card.is-open {
            box-shadow: 0 8px 25px rgba(0,0,0,0.08), inset 0 0 0 2px var(--polissacarideo-border);
        }
        #monossacarideos .topic-card.is-open {
            box-shadow: 0 8px 25px rgba(0,0,0,0.08), inset 0 0 0 2px var(--monossacarideo-border);
        }
        #di-e-polissacarideos .topic-card.is-open {
            box-shadow: 0 8px 25px rgba(0,0,0,0.08), inset 0 0 0 2px var(--dissacarideo-border);
        }
        
        #definicao-carboidratos .topic-card.is-open:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.1), inset 0 0 0 2px rgba(59, 130, 246, 0.6);
        }
        #monossacarideos .topic-card.is-open:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.1), inset 0 0 0 2px rgba(34, 197, 94, 0.6);
        }
        #di-e-polissacarideos .topic-card.is-open:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.1), inset 0 0 0 2px rgba(249, 115, 22, 0.6);
        }
        
        .term { 
            text-decoration: none; 
            cursor: pointer; 
            font-weight: 500;
            padding: 4px 10px;
            border-radius: 0.6rem;
            transition: all 0.2s ease-in-out;
            text-shadow: none;
        }
        #definicao-carboidratos .term { background-color: var(--polissacarideo-glow); color: #1d4ed8; }
        #monossacarideos .term { background-color: var(--monossacarideo-glow); color: #15803d; }
        #di-e-polissacarideos .term { background-color: var(--dissacarideo-glow); color: #c2410c; }
        .term:hover { 
            filter: brightness(1.15); 
        }
        
        .chemical-formula-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            align-items: center;
            justify-content: center;
        }

        /* Modal Styling */
        #modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(248, 250, 252, 0.5);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0s linear 0.4s;
            z-index: 1000;
        }
        #modal-overlay.visible {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.4s ease;
        }
        
        #modal-content {
            background: rgba(255, 255, 255, 0.55); 
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: var(--text-primary);
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.15);
            border-radius: 2rem;
            position: relative;
            width: 90%;
            max-width: 500px;
            transform: scale(0.95);
            transition: transform 0.4s ease;
            overflow: hidden; 
        }
        
        #modal-content.image-modal {
             max-width: 650px;
        }
        
        #modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: inherit;
            pointer-events: none;
            box-shadow: inset 0 0 0 1.5px rgba(255, 255, 255, 0.6);
            z-index: 1;
        }

        #modal-overlay.visible #modal-content { 
            transform: scale(1);
        }
        
        #modal-content.theme-definicao-carboidratos { box-shadow: 0 25px 50px -12px rgba(0,0,0,0.15), inset 0 0 0 2px var(--polissacarideo-border); }
        #modal-content.theme-monossacarideos { box-shadow: 0 25px 50px -12px rgba(0,0,0,0.15), inset 0 0 0 2px var(--monossacarideo-border); }
        #modal-content.theme-di-e-polissacarideos { box-shadow: 0 25px 50px -12px rgba(0,0,0,0.15), inset 0 0 0 2px var(--dissacarideo-border); }
        
        #modal-header, #modal-description {
            position: relative;
            z-index: 2;
        }

        #modal-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            background: transparent;
            text-align: center;
            padding: 1.5rem 3.5rem;
        }
        
        #modal-title { 
            font-size: 1.75rem; 
            font-weight: 700; 
            text-shadow: none;
        }
        #modal-header.theme-definicao-carboidratos #modal-title { color: var(--polissacarideo-color); }
        #modal-header.theme-monossacarideos #modal-title { color: var(--monossacarideo-color); }
        #modal-header.theme-di-e-polissacarideos #modal-title { color: var(--dissacarideo-color); }
        
        #modal-description { font-size: 1.05rem; color: var(--text-secondary); line-height: 1.7; padding: 1.5rem 2rem 2rem 2rem; }
        
        #modal-image-container {
            padding: 1.5rem;
            display: flex;
            justify-content: center;
        }
        #modal-image-container img {
            width: 100%;
            max-width: 450px;
            height: auto;
            border-radius: 1rem;
        }

        #modal-close-btn {
            position: absolute;
            top: 1rem; right: 1rem;
            background: rgba(0,0,0,0.05);
            border: none;
            border-radius: 50%;
            width: 2.5rem; height: 2.5rem;
            cursor: pointer; 
            transition: background-color 0.2s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--text-secondary);
            z-index: 3;
        }
        #modal-close-btn:hover { background: rgba(0,0,0,0.1); transform: scale(1.1); }
        
        .footer-signature { text-align: center; padding: 4rem 1rem; background-color: transparent; color: #94a3b8; }
        ul { list-style-position: inside; padding-left: 0.5rem;}
        li { margin-bottom: 0.5rem; }

        /* == Quiz Styles == */
        #quiz-section {
             background: rgba(255, 255, 255, 0.2);
             backdrop-filter: blur(15px);
             -webkit-backdrop-filter: blur(15px);
             border-top: 1px solid rgba(255, 255, 255, 0.3);
             padding-bottom: 4rem;
        }

        .quiz-container {
            max-width: 800px;
            width: 100%;
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 2rem;
            padding: 2.5rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            position: relative;
        }
        
        #progress-bar-container {
            width: 100%;
            max-width: 800px;
            background-color: rgba(255, 255, 255, 0.4);
            border-radius: 9999px;
            padding: 0.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        #progress-bar-fill {
            height: 1.5rem;
            background: linear-gradient(90deg, #4ade80, #3b82f6);
            border-radius: 9999px;
            transition: width 0.5s ease-in-out;
            text-align: center;
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
        }
        #progress-label {
            text-align: center;
            margin-top: 0.75rem;
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        #question-counter-display {
            position: absolute;
            top: 2.5rem;
            right: 2.5rem;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: white;
            transition: all 0.3s ease;
        }
        #question-counter-display.facil-bg {
            background-color: #22c55e; /* green-500 */
        }
        #question-counter-display.media-bg {
            background-color: #f59e0b; /* amber-500 */
        }
        #question-counter-display.dificil-bg {
            background-color: #ef4444; /* red-500 */
        }
        
        #timer-display {
            position: absolute;
            top: 2.5rem;
            left: 2.5rem;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background-color: rgba(255,255,255,0.4);
            border: 3px solid var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        #timer-display.warning {
            border-color: #f59e0b;
            color: #b45309;
            transform: scale(1.1);
        }
        #timer-display.danger {
            border-color: #ef4444;
            color: #991b1b;
            transform: scale(1.1);
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.5); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        
        #modal-description { font-size: 1.05rem; color: var(--text-secondary); line-height: 1.7; padding: 0 2rem 2rem 2rem; }
        
        #quiz-question {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2rem;
            padding: 0 96px; /* Space for timer and difficulty */
            text-align: center;
        }

        #quiz-options {
            list-style: none;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .quiz-option {
            background-color: rgba(255,255,255,0.7);
            border: 1px solid rgba(0,0,0,0.05);
            border-radius: 1rem;
            padding: 1.25rem;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out, background-color 0.2s ease-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.07), 0 2px 4px -2px rgba(0, 0, 0, 0.07);
            will-change: transform, box-shadow;
        }

        .quiz-option:hover {
            transform: translateY(-3px);
            background-color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
        
        .quiz-option.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .quiz-option.correct-answer {
            border-color: #22c55e;
            background-color: #f0fdf4;
            color: #15803d;
            font-weight: 600;
        }
        
        .quiz-option.incorrect-answer {
            border-color: #ef4444;
            background-color: #fef2f2;
            color: #b91c1c;
            font-weight: 600;
        }

        #quiz-start-btn, #restart-quiz-btn {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            font-weight: 700;
            padding: 1rem 2.5rem;
            border-radius: 1rem;
            font-size: 1.2rem;
            border: 1px solid rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        #quiz-start-btn {
            color: var(--text-primary);
        }
        #restart-quiz-btn {
            color: var(--dissacarideo-color);
             margin-top: 2rem;
        }

        #quiz-start-btn:hover, #restart-quiz-btn:hover {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.6);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        #quiz-results {
             text-align: center;
        }
        
        #quiz-results h3 {
             font-size: 2rem;
             font-weight: 700;
             margin-bottom: 1.5rem;
        }

        #quiz-percentage {
            font-size: 3.5rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 2rem;
            width: 150px;
            height: 150px;
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: auto;
            margin-right: auto;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .results-stats {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 2.5rem;
            font-size: 1.1rem;
        }
        
        .stat-correct, .stat-incorrect {
            font-weight: 600;
            color: var(--text-primary);
            padding: 0.5rem 1.25rem;
            border-radius: 9999px;
            transition: all 0.2s ease-in-out;
        }

        .stat-correct {
            background-color: rgba(34, 197, 94, 0.25); 
        }

        .stat-incorrect {
            background-color: rgba(239, 68, 68, 0.25);
        }
        
        #missed-topics-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.75rem;
            list-style: none;
            padding: 0;
            margin-top: 1rem;
        }

        .missed-topic-bubble {
            background-color: #f1f5f9;
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .missed-topic-bubble:hover {
            background-color: #e2e8f0;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .missed-topic-bubble.visited-topic {
            border-color: #22c55e;
            background-color: #f0fdf4;
            color: #166534;
        }

    </style>
</head>
<body>
    <div class="background-container">
        <div class="light-bubble b1"></div>
        <div class="light-bubble b2"></div>
        <div class="light-bubble b3"></div>
        <div class="dynamic-bg-glow" id="bg-definicao-carboidratos"></div>
        <div class="dynamic-bg-glow" id="bg-monossacarideos"></div>
        <div class="dynamic-bg-glow" id="bg-di-e-polissacarideos"></div>
    </div>

    <!-- Hero Section -->
    <section id="hero" class="section-container">
        <div class="section-header-card">
            <h1>Carboidratos</h1>
            <p class="mt-4">Uma jornada interativa pela bioqu√≠mica dos a√ß√∫cares, explorando sua estrutura, fun√ß√£o e import√¢ncia fundamental para a vida.</p>
        </div>
    </section>
    
    <!-- Definition Section -->
    <section id="definicao-carboidratos" class="section-container">
        <div class="section-header-card">
            <h2 class="section-title">O Que S√£o Carboidratos?</h2>
            <p class="section-subtitle">As biomol√©culas mais abundantes da natureza. Eles s√£o a principal fonte de energia para os seres vivos e desempenham pap√©is estruturais cruciais.</p>
        </div>
        <div class="topics-grid">
            <div class="topic-card" id="topic-definicao-basica">
                <div class="summary">Defini√ß√£o e Estrutura B√°sica</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <ul>
                            <li>Quimicamente, s√£o definidos como <span class="term" data-description="Mol√©culas que possuem m√∫ltiplos grupos hidroxila (-OH) e um grupo alde√≠do (-CHO) ou cetona (C=O).">poliidroxialde√≠dos ou poliidroxicetonas</span>.</li>
                            <li>Sua f√≥rmula emp√≠rica geral √© (CH‚ÇÇO)n, o que lhes deu o nome "hidratos de carbono".</li>
                            <li>A estrutura consiste em uma cadeia de carbono com um grupo carbonila (C=O) e v√°rios grupos hidroxila (-OH).</li>
                            <li>O sufixo caracter√≠stico para carboidratos √© <span class="term" data-description="Exemplos: Glicose, Frutose, Sacarose, Lactose."> -ose</span>.</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="topic-card" id="topic-funcoes-biologicas">
                <div class="summary">Fun√ß√µes Biol√≥gicas</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <ul>
                            <li><strong>Fonte de Energia:</strong> S√£o a principal fonte de energia metab√≥lica e s√£o armazenados para uso futuro (ex: glicog√™nio em animais, amido em plantas).</li>
                            <li><strong>Estrutural:</strong> Formam componentes essenciais como a <span class="term" data-description="Um polissacar√≠deo estrutural que comp√µe a parede celular das plantas, dando-lhes rigidez.">celulose</span> nas plantas e a quitina em fungos.</li>
                             <li><strong>Componentes de √Åcidos Nucleicos:</strong> A ribose e a desoxirribose s√£o a√ß√∫cares que formam o esqueleto do RNA e DNA, respectivamente.</li>
                            <li><strong>Sinaliza√ß√£o Celular:</strong> Ligam-se a prote√≠nas e lip√≠dios para formar <span class="term" data-description="Mol√©culas compostas por carboidratos ligados a prote√≠nas (glicoprote√≠nas) ou lip√≠dios (glicolip√≠dios), que atuam como marcadores na superf√≠cie celular para reconhecimento e comunica√ß√£o.">glicoconjugados</span>, importantes para o reconhecimento celular.</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="topic-card" id="topic-classificacao">
                <div class="summary">Classifica√ß√£o dos Carboidratos</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        Eles s√£o classificados pelo n√∫mero de unidades de a√ß√∫car que cont√™m:
                        <ul>
                            <li><span class="term" data-description="A unidade mais simples de um carboidrato, tamb√©m chamada de 'a√ß√∫car simples'. Exemplos incluem glicose e frutose.">Monossacar√≠deos:</span> Uma √∫nica unidade de a√ß√∫car.</li>
                            <li><span class="term" data-description="Formados por duas a cerca de 20 unidades de monossacar√≠deos ligadas. Os dissacar√≠deos (duas unidades) s√£o os mais comuns, como a sacarose (a√ß√∫car de mesa).">Oligossacar√≠deos:</span> Cadeias curtas de monossacar√≠deos.</li>
                            <li><span class="term" data-description="Pol√≠meros longos com centenas ou milhares de unidades de monossacar√≠deos. Podem ser lineares (celulose) ou ramificados (glicog√™nio).">Polissacar√≠deos:</span> Cadeias muito longas (pol√≠meros).</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Monosaccharides Section -->
    <section id="monossacarideos" class="section-container">
         <div class="section-header-card">
            <h2 class="section-title">Monossacar√≠deos</h2>
            <p class="section-subtitle">Os blocos de constru√ß√£o fundamentais de todos os carboidratos. S√£o a√ß√∫cares simples que n√£o podem ser quebrados em unidades menores.</p>
        </div>
        <div class="topics-grid">
            <div class="topic-card" id="topic-aldose-cetose">
                <div class="summary">Aldoses e Cetoses</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        A classifica√ß√£o prim√°ria dos monossacar√≠deos baseia-se na posi√ß√£o do grupo carbonila (C=O):
                        <ul>
                            <li><span class="term" data-description="Um monossacar√≠deo com o grupo carbonila (C=O) localizado na extremidade da cadeia de carbono, formando um grupo alde√≠do. A glicose √© o exemplo mais famoso.">Aldose:</span> O C=O est√° na extremidade (C1).</li>
                            <li><span class="term" data-description="Um monossacar√≠deo com o grupo carbonila (C=O) em qualquer outra posi√ß√£o que n√£o seja a extremidade, formando um grupo cetona. A frutose √© um exemplo comum.">Cetose:</span> O C=O est√° em uma posi√ß√£o interna.</li>
                        </ul>
                        <div class="image-bubble" data-img-svg="false" data-img-description="Compara√ß√£o entre uma aldotriose (Gliceralde√≠do) e uma cetotriose (Diidroxiacetona). A diferen√ßa chave √© a posi√ß√£o do grupo carbonila (C=O): na extremidade para a aldose (Carbono 1) e no meio da cadeia para a cetose (Carbono 2).">
                           <img src="aldose-cetose .jpg" alt="Compara√ß√£o entre Aldose e Cetose" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="topic-card" id="topic-linear-ciclica">
                <div class="summary">Forma Linear vs. C√≠clica</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <ul>
                            <li>Monossacar√≠deos com 4 ou mais carbonos, como a glicose, existem em um equil√≠brio entre a forma linear (cadeia aberta) e a forma c√≠clica (anel).</li>
                            <li>A forma c√≠clica √© energeticamente mais est√°vel e predominante em solu√ß√£o aquosa.</li>
                            <li>A cicliza√ß√£o ocorre quando o grupo carbonila reage com um grupo hidroxila da mesma mol√©cula. Em aldoses, forma-se um <span class="term" data-description="Estrutura em anel formada pela rea√ß√£o intramolecular de um alde√≠do com um √°lcool.">hemiacetal</span>.</li>
                        </ul>
                        <div class="image-bubble" data-img-svg="false" data-img-description="A D-Glicose pode existir em uma forma de cadeia aberta (linear) ou em uma forma de anel (c√≠clica), que √© mais est√°vel em solu√ß√£o. A forma c√≠clica √© resultado de uma rea√ß√£o interna entre o grupo alde√≠do (C1) e a hidroxila (C5).">
                            <img src="glicose.jpg" alt="Compara√ß√£o entre forma linear e c√≠clica da Glicose" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="topic-card" id="topic-epimeros">
                <div class="summary">Isomeria: Ep√≠meros</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <ul>
                            <li>Is√¥meros s√£o mol√©culas com a mesma f√≥rmula qu√≠mica, mas com arranjos espaciais diferentes.</li>
                            <li><span class="term" data-description="Dois is√¥meros que diferem na configura√ß√£o de apenas UM centro assim√©trico (carbono quiral).">Ep√≠meros</span> s√£o um tipo de is√¥mero.</li>
                            <li>Por exemplo, a <strong>D-Glicose</strong>, <strong>D-Manose</strong> e <strong>D-Galactose</strong> s√£o ep√≠meros entre si:</li>
                            <li>A Manose difere da Glicose apenas na posi√ß√£o da hidroxila do Carbono 2 (C2).</li>
                            <li>A Galactose difere da Glicose apenas na posi√ß√£o da hidroxila do Carbono 4 (C4).</li>
                        </ul>
                        <div class="image-bubble" data-img-svg="false" data-img-description="Ep√≠meros s√£o is√¥meros que diferem na configura√ß√£o de apenas um carbono quiral. A D-Manose √© um ep√≠mero da D-Glicose no carbono C2. A D-Galactose √© um ep√≠mero da D-Glicose no carbono C4.">
                            <img src="epimero.jpg" alt="Compara√ß√£o entre ep√≠meros D-Manose, D-Glicose e D-Galactose" />
                        </div>
                    </div>
                </div>
            </div>
             <div class="topic-card" id="topic-anomeros">
                <div class="summary">Isomeria: An√¥meros (Œ± e Œ≤)</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <ul>
                            <li>A cicliza√ß√£o de um monossacar√≠deo cria um novo centro quiral no carbono que antes era da carbonila. Este √© chamado de <span class="term" data-description="O carbono que pertencia ao grupo carbonila (alde√≠do ou cetona) na forma linear e que se torna um novo centro quiral na forma c√≠clica.">carbono anom√©rico</span>.</li>
                            <li>Isso resulta em dois estereois√¥meros chamados <span class="term" data-description="Is√¥meros de um a√ß√∫car c√≠clico que diferem apenas na configura√ß√£o do carbono anom√©rico (C1 em aldoses).">an√¥meros</span>, designados como alfa (Œ±) e beta (Œ≤).</li>
                            <li>Na <strong>Œ±-D-Glicose</strong>, a hidroxila (-OH) do carbono anom√©rico est√° em posi√ß√£o oposta (trans) ao grupo -CH‚ÇÇOH (C6).</li>
                            <li>Na <strong>Œ≤-D-Glicose</strong>, a hidroxila (-OH) est√° na mesma posi√ß√£o (cis) que o grupo -CH‚ÇÇOH.</li>
                        </ul>
                         <div class="image-bubble" data-img-svg="false" data-img-description="An√¥meros s√£o is√¥meros que diferem na configura√ß√£o do carbono anom√©rico (o C1 em aldoses), que √© formado durante a cicliza√ß√£o. Na Œ±-D-Glicopiranose, a hidroxila (OH) do C1 est√° para baixo (trans em rela√ß√£o ao CH‚ÇÇOH). Na Œ≤-D-Glicopiranose, ela est√° para cima (cis em rela√ß√£o ao CH‚ÇÇOH).">
                            <img src="alpha-beta.jpg" alt="Compara√ß√£o entre an√¥meros Alfa e Beta da Glicose" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Di- and Polysaccharides Section -->
    <section id="di-e-polissacarideos" class="section-container">
        <div class="section-header-card">
            <h2 class="section-title">Ligando os Mon√¥meros</h2>
            <p class="section-subtitle">Quando os monossacar√≠deos se unem, formam mol√©culas maiores e mais complexas, com fun√ß√µes que v√£o desde o a√ß√∫car de mesa at√© as estruturas das √°rvores.</p>
        </div>
        <div class="topics-grid">
            <div class="topic-card" id="topic-ligacao-glicosidica">
                <div class="summary">A Liga√ß√£o Glicos√≠dica</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <ul>
                            <li>Monossacar√≠deos se unem para formar oligossacar√≠deos e polissacar√≠deos atrav√©s de uma <span class="term" data-description="Uma liga√ß√£o covalente formada entre o carbono anom√©rico de um a√ß√∫car e um grupo hidroxila de outro a√ß√∫car. Uma mol√©cula de √°gua √© liberada neste processo (rea√ß√£o de desidrata√ß√£o).">liga√ß√£o glicos√≠dica</span>.</li>
                            <li>A orienta√ß√£o (Œ± ou Œ≤) do carbono anom√©rico que participa da liga√ß√£o determina se a liga√ß√£o √© do tipo Œ± ou Œ≤.</li>
                            <li>Isso tem consequ√™ncias profundas para a estrutura e fun√ß√£o da mol√©cula final.</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="topic-card" id="topic-dissacarideos">
                <div class="summary">Dissacar√≠deos Comuns</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        Dissacar√≠deos s√£o formados por duas unidades de monossacar√≠deos.
                        <ul>
                            <li><strong>Maltose:</strong> Formada por duas unidades de D-Glicose unidas por uma liga√ß√£o <span class="term" data-description="Liga√ß√£o entre o carbono 1 (em configura√ß√£o alfa) da primeira glicose e o carbono 4 da segunda glicose.">Œ±(1‚Üí4)</span>. √â o a√ß√∫car do malte.</li>
                             <li><strong>Sacarose:</strong> Formada por Glicose + Frutose. √â o a√ß√∫car de mesa comum.</li>
                              <li><strong>Lactose:</strong> Formada por Galactose + Glicose. √â o a√ß√∫car do leite.</li>
                        </ul>
                        <div class="image-bubble" data-img-svg="false" data-img-description="A Maltose √© um dissacar√≠deo formado pela uni√£o de duas mol√©culas de D-Glicose atrav√©s de uma liga√ß√£o glicos√≠dica do tipo Œ±(1‚Üí4). Essa liga√ß√£o ocorre entre o carbono 1 da primeira glicose e o carbono 4 da segunda, com a libera√ß√£o de uma mol√©cula de √°gua.">
                           <img src="Liga√ß√£o glicos√≠dica.jpg" alt="Forma√ß√£o da Maltose a partir de duas mol√©culas de Glicose" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="topic-card" id="topic-polissacarideos-reserva">
                <div class="summary">Polissacar√≠deos de Reserva</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        S√£o pol√≠meros de glicose usados para armazenar energia.
                         <ul>
                            <li><strong>Amido (Plantas):</strong> Uma mistura de amilose (linear, liga√ß√µes Œ±(1‚Üí4)) e amilopectina (ramificada, com pontos de ramifica√ß√£o Œ±(1‚Üí6)).</li>
                            <li><span class="term" data-description="A principal forma de armazenamento de glicose em animais, encontrado principalmente no f√≠gado e nos m√∫sculos. √â um pol√≠mero de glicose altamente ramificado, com liga√ß√µes Œ±(1‚Üí4) na cadeia principal e liga√ß√µes Œ±(1‚Üí6) nos pontos de ramifica√ß√£o.">Glicog√™nio (Animais):</span> Similar √† amilopectina, mas ainda mais ramificado. Permite uma libera√ß√£o r√°pida de glicose quando necess√°rio.</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="topic-card" id="topic-polissacarideos-estruturais">
                <div class="summary">Polissacar√≠deos Estruturais</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        Fornecem suporte e rigidez √†s estruturas biol√≥gicas.
                        <ul>
                            <li><strong>Celulose (Plantas):</strong> Pol√≠mero linear de glicose unido por liga√ß√µes <span class="term" data-description="As liga√ß√µes beta criam cadeias retas e r√≠gidas que se alinham em fibras fortes, ideais para estrutura. A maioria dos animais, incluindo humanos, n√£o consegue digerir as liga√ß√µes Œ≤(1‚Üí4) da celulose.">Œ≤(1‚Üí4)</span>. √â o principal componente da parede celular vegetal e a mol√©cula org√¢nica mais abundante na Terra.</li>
                            <li><strong>Quitina (Fungos e Insetos):</strong> Semelhante √† celulose, mas com um grupo acetilamina no carbono 2 da glicose. Forma o exoesqueleto de artr√≥podes e a parede celular de fungos.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Quiz Section -->
    <section id="quiz-section" class="section-container">
        <div class="section-header-card">
            <h2 class="section-title">Teste seu Conhecimento</h2>
            <p class="section-subtitle">Vamos ver o que voc√™ aprendeu! Responda √†s perguntas a seguir para testar sua compreens√£o sobre os carboidratos.</p>
        </div>

        <div id="quiz-area" class="w-full max-w-3xl flex flex-col items-center">
            
            <!-- Progress Bar -->
            <div id="progress-bar-container">
                <div id="progress-bar-fill" style="width: 0%;">0%</div>
            </div>
            <div id="progress-label">Progresso: 0 de 60 quest√µes dominadas</div>

            <div id="quiz-container" class="quiz-container hidden">
                <div id="timer-display">30</div>
                <div id="question-counter-display"></div>
                <h3 id="quiz-question"></h3>
                <ul id="quiz-options"></ul>
            </div>
            <div id="quiz-results" class="quiz-container hidden">
                <h3>Quiz Finalizado!</h3>
                <div id="quiz-percentage">100%</div>
                <div class="results-stats">
                    <span id="stat-correct-count" class="stat-correct"></span>
                    <span id="stat-incorrect-count" class="stat-incorrect"></span>
                </div>
                <h4 class="text-lg font-semibold mt-6 mb-2 text-slate-700">T√≥picos para revisar:</h4>
                <ul id="missed-topics-list"></ul>
                 <button id="restart-quiz-btn">Novo Quiz</button>
            </div>
            <button id="quiz-start-btn">Come√ßar Quiz</button>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer-signature">
        <p>Feito por Rafael Chaves Sebe.</p>
    </footer>

    <!-- Modal Structure -->
    <div id="modal-overlay" class="fixed inset-0">
        <div id="modal-content" class="relative">
             <button id="modal-close-btn" class="absolute top-4 right-4 z-20">&times;</button>
            <div id="modal-header" class="relative hidden">
                <h3 id="modal-title"></h3>
            </div>
            <div id="modal-image-container" class="hidden">
                <!-- Image will be injected here by JS -->
            </div>
            <p id="modal-description"></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Observer for section background changes
            const bgObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const glowId = `bg-${entry.target.id}`;
                    const glowEl = document.getElementById(glowId);
                    if (glowEl) {
                        if (entry.isIntersecting) {
                            glowEl.style.opacity = '0.25';
                        } else {
                            glowEl.style.opacity = '0';
                        }
                    }
                });
            }, { threshold: 0.4 }); 

            document.querySelectorAll('#definicao-carboidratos, #monossacarideos, #di-e-polissacarideos').forEach(section => {
                bgObserver.observe(section);
            });

            // Observer for card animations
            const cardObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    } else if (entry.boundingClientRect.top > 0) {
                        entry.target.classList.remove('visible');
                    }
                });
            }, {
                threshold: 0.01
            });
            document.querySelectorAll('.topic-card, .section-header-card').forEach(card => {
                cardObserver.observe(card);
            });

            // Modal logic
            const modalOverlay = document.getElementById('modal-overlay');
            const modalContent = document.getElementById('modal-content');
            const modalHeader = document.getElementById('modal-header');
            const modalTitle = document.getElementById('modal-title');
            const modalDescription = document.getElementById('modal-description');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const modalImageContainer = document.getElementById('modal-image-container');

            function openModal() {
                modalOverlay.classList.add('visible');
                document.body.style.overflow = 'hidden';
            }

            const closeModal = () => {
                modalOverlay.classList.remove('visible');
                setTimeout(() => {
                    if (!modalOverlay.classList.contains('visible')) {
                         document.body.style.overflow = '';
                         modalImageContainer.innerHTML = '';
                    }
                }, 400); 
            };

            // Event Listeners for Terms
            document.querySelectorAll('.term').forEach(term => {
                term.addEventListener('click', (event) => {
                    event.preventDefault();
                    const title = term.textContent;
                    const description = term.getAttribute('data-description');
                    const parentSection = term.closest('section');
                    let theme = 'definicao-carboidratos'; 
                    if (parentSection && parentSection.id) {
                       if (parentSection.id === 'monossacarideos') theme = 'monossacarideos';
                       else if (parentSection.id === 'di-e-polissacarideos') theme = 'di-e-polissacarideos';
                    }
                    
                    modalContent.classList.remove('image-modal');
                    modalHeader.classList.remove('hidden');
                    modalImageContainer.classList.add('hidden');
                    
                    modalTitle.textContent = title;
                    modalDescription.textContent = description;
                    
                    modalContent.className = 'relative'; 
                    modalHeader.className = '';
                    modalContent.classList.add(`theme-${theme}`);
                    modalHeader.classList.add(`theme-${theme}`);
                    
                    openModal();
                });
            });

            // Event Listeners for Images
            document.querySelectorAll('.image-bubble').forEach(bubble => {
                bubble.addEventListener('click', () => {
                    const isSvg = bubble.dataset.imgSvg === 'true';
                    const description = bubble.dataset.imgDescription;
                    const parentSection = bubble.closest('section');
                     let theme = 'definicao-carboidratos'; 
                    if (parentSection && parentSection.id) {
                       if (parentSection.id === 'monossacarideos') theme = 'monossacarideos';
                       else if (parentSection.id === 'di-e-polissacarideos') theme = 'di-e-polissacarideos';
                    }

                    modalContent.classList.add('image-modal');
                    modalHeader.classList.add('hidden');
                    modalImageContainer.classList.remove('hidden');
                    
                    modalImageContainer.innerHTML = ''; // Limpa conte√∫do anterior

                    if (isSvg) {
                       const svgElement = bubble.querySelector('svg');
                       if (svgElement) modalImageContainer.innerHTML = svgElement.outerHTML;
                    } else {
                        const imgElement = bubble.querySelector('img');
                        if (imgElement) {
                            const newImg = document.createElement('img');
                            newImg.src = imgElement.src;
                            newImg.alt = imgElement.alt;
                            modalImageContainer.appendChild(newImg);
                        }
                    }
                    
                    modalDescription.textContent = description;

                    modalContent.className = 'relative image-modal'; 
                    modalContent.classList.add(`theme-${theme}`);

                    openModal();
                });
            });

            modalCloseBtn.addEventListener('click', closeModal);
            modalOverlay.addEventListener('click', (event) => {
                if (event.target === modalOverlay) closeModal();
            });
            
            // Accordion logic
            document.querySelectorAll('.topic-card .summary').forEach(summary => {
                summary.addEventListener('click', (e) => {
                    const card = e.currentTarget.parentElement;
                    toggleAccordion(card);
                });
            });

            function toggleAccordion(cardToToggle) {
                const contentWrapper = cardToToggle.querySelector('.topic-content-wrapper');
                const isOpen = cardToToggle.classList.contains('is-open');

                const parentGrid = cardToToggle.closest('.topics-grid');
                parentGrid.querySelectorAll('.topic-card.is-open').forEach(openCard => {
                    if (openCard !== cardToToggle) {
                        const otherContentWrapper = openCard.querySelector('.topic-content-wrapper');
                        otherContentWrapper.style.maxHeight = '0px';
                        openCard.classList.remove('is-open');
                    }
                });

                if (isOpen) {
                    contentWrapper.style.maxHeight = '0px';
                    cardToToggle.classList.remove('is-open');
                } else {
                    const content = cardToToggle.querySelector('.topic-content');
                    contentWrapper.style.maxHeight = content.scrollHeight + 'px';
                    cardToToggle.classList.add('is-open');
                }
            }
            
            // ===================================
            // == QUIZ LOGIC
            // ===================================

            const questionBank = [
                // --- F√ÅCIL: 20 quest√µes ---
                { id: 1, difficulty: 'F√°cil', question: "Qual √© a defini√ß√£o qu√≠mica de um carboidrato?", topic: "Defini√ß√£o e Estrutura B√°sica", options: ["Poli-hidroxi√°cidos", "Poliidroxialde√≠dos ou poliidroxicetonas", "Cadeias de amino√°cidos", "√Åcidos graxos com glicerol"], correctAnswer: 1 },
                { id: 2, difficulty: 'F√°cil', question: "Qual o sufixo caracter√≠stico da maioria dos carboidratos?", topic: "Defini√ß√£o e Estrutura B√°sica", options: ["-ina", "-ase", "-ol", "-ose"], correctAnswer: 3 },
                { id: 3, difficulty: 'F√°cil', question: "Qual √© a principal fun√ß√£o dos carboidratos nos organismos vivos?", topic: "Fun√ß√µes Biol√≥gicas", options: ["Isolamento t√©rmico", "Armazenamento de informa√ß√£o gen√©tica", "Fonte e armazenamento de energia", "Cat√°lise de rea√ß√µes"], correctAnswer: 2 },
                { id: 4, difficulty: 'F√°cil', question: "A glicose √© um exemplo de qual tipo de carboidrato?", topic: "Classifica√ß√£o dos Carboidratos", options: ["Monossacar√≠deo", "Dissacar√≠deo", "Polissacar√≠deo", "Oligossacar√≠deo"], correctAnswer: 0 },
                { id: 5, difficulty: 'F√°cil', question: "Uma mol√©cula com o grupo carbonila (C=O) na extremidade da cadeia √© classificada como:", topic: "Aldoses e Cetoses", options: ["Cetose", "Aldose", "Sacarose", "Polissacar√≠deo"], correctAnswer: 1 },
                { id: 6, difficulty: 'F√°cil', question: "Qual √© o a√ß√∫car encontrado no leite?", topic: "Dissacar√≠deos Comuns", options: ["Maltose", "Sacarose", "Lactose", "Frutose"], correctAnswer: 2 },
                { id: 7, difficulty: 'F√°cil', question: "A celulose, encontrada na parede celular das plantas, √© um exemplo de:", topic: "Polissacar√≠deos Estruturais", options: ["Monossacar√≠deo", "Dissacar√≠deo", "Polissacar√≠deo estrutural", "Polissacar√≠deo de reserva"], correctAnswer: 2 },
                { id: 8, difficulty: 'F√°cil', question: "Qual polissacar√≠deo √© a principal forma de armazenamento de energia em animais?", topic: "Polissacar√≠deos de Reserva", options: ["Amido", "Celulose", "Quitina", "Glicog√™nio"], correctAnswer: 3 },
                { id: 9, difficulty: 'F√°cil', isGraphic: true, question: "Observando a imagem, qual mol√©cula √© uma cetose?", topic: "Aldoses e Cetoses", options: ["D-Gliceralde√≠do", "Diidroxiacetona", "Ambas", "Nenhuma"], correctAnswer: 1, imageName: "aldose-cetose .jpg" },
                { id: 10, difficulty: 'F√°cil', question: "A uni√£o de duas mol√©culas de glicose forma qual dissacar√≠deo?", topic: "Dissacar√≠deos Comuns", options: ["Sacarose", "Lactose", "Maltose", "Frutose"], correctAnswer: 2 },
                { id: 11, difficulty: 'F√°cil', question: "A f√≥rmula emp√≠rica geral da maioria dos carboidratos √©:", topic: "Defini√ß√£o e Estrutura B√°sica", options: ["(CHO)n", "(CH‚ÇÇO)n", "(C‚ÇÇH‚ÇÇO)n", "(CHO‚ÇÇ)n"], correctAnswer: 1 },
                { id: 12, difficulty: 'F√°cil', question: "Qual das seguintes n√£o √© uma fun√ß√£o principal dos carboidratos?", topic: "Fun√ß√µes Biol√≥gicas", options: ["Fonte de energia", "Estrutura do DNA/RNA", "Cat√°lise de rea√ß√µes (enzimas)", "Sinaliza√ß√£o celular"], correctAnswer: 2 },
                { id: 13, difficulty: 'F√°cil', question: "Um polissacar√≠deo √© formado por mais de quantas unidades de monossacar√≠deos?", topic: "Classifica√ß√£o dos Carboidratos", options: ["2", "5", "10", "20"], correctAnswer: 3 },
                { id: 14, difficulty: 'F√°cil', question: "A frutose, encontrada em frutas, √© um exemplo de:", topic: "Aldoses e Cetoses", options: ["Aldose", "Cetose", "Polissacar√≠deo", "Dissacar√≠deo"], correctAnswer: 1 },
                { id: 15, difficulty: 'F√°cil', question: "A sacarose, o a√ß√∫car de mesa, √© um dissacar√≠deo formado por:", topic: "Dissacar√≠deos Comuns", options: ["Glicose + Glicose", "Glicose + Galactose", "Glicose + Frutose", "Frutose + Frutose"], correctAnswer: 2 },
                { id: 16, difficulty: 'F√°cil', question: "O amido √© a forma de armazenamento de energia em qual tipo de organismo?", topic: "Polissacar√≠deos de Reserva", options: ["Animais", "Fungos", "Bact√©rias", "Plantas"], correctAnswer: 3 },
                { id: 17, difficulty: 'F√°cil', question: "Qual o nome da liga√ß√£o que une os monossacar√≠deos?", topic: "A Liga√ß√£o Glicos√≠dica", options: ["Pept√≠dica", "Glicos√≠dica", "Fosfodi√©ster", "I√¥nica"], correctAnswer: 1 },
                { id: 18, difficulty: 'F√°cil', isGraphic: true, question: "A imagem mostra a forma c√≠clica de qual monossacar√≠deo?", topic: "Linear vs. C√≠clica", options: ["Frutose", "Ribose", "Glicose", "Galactose"], correctAnswer: 2, imageName: "glicose.jpg" },
                { id: 19, difficulty: 'F√°cil', isGraphic: true, question: "Na imagem da forma√ß√£o da maltose, quantas mol√©culas de glicose s√£o necess√°rias?", topic: "Dissacar√≠deos Comuns", options: ["Uma", "Duas", "Tr√™s", "Quatro"], correctAnswer: 1, imageName: "Liga√ß√£o glicos√≠dica.jpg" },
                { id: 20, difficulty: 'F√°cil', question: "Ribose √© um monossacar√≠deo essencial para qual mol√©cula?", topic: "Fun√ß√µes Biol√≥gicas", options: ["Prote√≠nas", "DNA", "RNA", "Gorduras"], correctAnswer: 2 },

                // --- M√âDIA: 20 quest√µes ---
                { id: 21, difficulty: 'M√©dia', question: "O que s√£o ep√≠meros?", topic: "Isomeria: Ep√≠meros", options: ["Is√¥meros que s√£o imagens especulares um do outro", "Is√¥meros que diferem na configura√ß√£o de todos os carbonos quirais", "Is√¥meros que diferem na configura√ß√£o de apenas um carbono quiral", "Is√¥meros com diferentes f√≥rmulas moleculares"], correctAnswer: 2 },
                { id: 22, difficulty: 'M√©dia', question: "A D-Galactose √© um ep√≠mero da D-Glicose em qual carbono?", topic: "Isomeria: Ep√≠meros", options: ["C1", "C2", "C3", "C4"], correctAnswer: 3 },
                { id: 23, difficulty: 'M√©dia', question: "A forma c√≠clica de uma aldose, como a glicose, √© chamada de:", topic: "Linear vs. C√≠clica", options: ["Hemicetal", "Hemiacetal", "Cetona", "Alde√≠do"], correctAnswer: 1 },
                { id: 24, difficulty: 'M√©dia', question: "Qual √© a principal diferen√ßa entre os an√¥meros Œ± e Œ≤ da glicose?", topic: "Isomeria: An√¥meros (Œ± e Œ≤)", options: ["O n√∫mero de √°tomos de carbono", "A posi√ß√£o da hidroxila no carbono anom√©rico (C1)", "Se a forma √© linear ou c√≠clica", "A presen√ßa de um grupo alde√≠do ou cetona"], correctAnswer: 1 },
                { id: 25, difficulty: 'M√©dia', question: "Que tipo de rea√ß√£o forma uma liga√ß√£o glicos√≠dica?", topic: "A Liga√ß√£o Glicos√≠dica", options: ["Hidr√≥lise", "Oxida√ß√£o", "Desidrata√ß√£o", "Redu√ß√£o"], correctAnswer: 2 },
                { id: 26, difficulty: 'M√©dia', question: "Qual a diferen√ßa estrutural fundamental entre amido/glicog√™nio e celulose?", topic: "Polissacar√≠deos Estruturais", options: ["A celulose √© feita de frutose, e o amido de glicose", "O tipo de liga√ß√£o glicos√≠dica (Œ± no amido, Œ≤ na celulose)", "O amido √© linear e a celulose √© ramificada", "A celulose √© encontrada em animais e o amido em plantas"], correctAnswer: 1 },
                { id: 27, difficulty: 'M√©dia', question: "Por que os humanos n√£o conseguem digerir celulose?", topic: "Polissacar√≠deos Estruturais", options: ["Porque a celulose √© muito grande", "Porque n√£o temos enzimas para quebrar as liga√ß√µes glicos√≠dicas Œ≤(1‚Üí4)", "Porque a celulose n√£o cont√©m energia", "Porque n√£o temos enzimas para quebrar as liga√ß√µes Œ±(1‚Üí4)"], correctAnswer: 1 },
                { id: 28, difficulty: 'M√©dia', isGraphic: true, question: "Na imagem da forma√ß√£o da Maltose, qual tipo de liga√ß√£o glicos√≠dica √© formada?", topic: "Dissacar√≠deos Comuns", options: ["Œ±(1‚Üí2)", "Œ≤(1‚Üí4)", "Œ±(1‚Üí4)", "Œ±(1‚Üí6)"], correctAnswer: 2, imageName: "Liga√ß√£o glicos√≠dica.jpg" },
                { id: 29, difficulty: 'M√©dia', question: "Glicoconjugados, como glicoprote√≠nas, s√£o importantes para qual fun√ß√£o celular?", topic: "Fun√ß√µes Biol√≥gicas", options: ["Armazenamento de energia prim√°ria", "Reconhecimento e sinaliza√ß√£o na superf√≠cie celular", "Contra√ß√£o muscular", "Transporte de oxig√™nio"], correctAnswer: 1 },
                { id: 30, difficulty: 'M√©dia', isGraphic: true, question: "A forma c√≠clica da glicose √© mais ou menos est√°vel que a forma linear em solu√ß√£o?", topic: "Linear vs. C√≠clica", options: ["Mais est√°vel", "Menos est√°vel", "Igualmente est√°vel", "Depende da temperatura"], correctAnswer: 0, imageName: "glicose.jpg" },
                { id: 31, difficulty: 'M√©dia', question: "Qual √© o carbono anom√©rico?", topic: "Isomeria: An√¥meros (Œ± e Œ≤)", options: ["O √∫ltimo carbono da cadeia", "Qualquer carbono com uma hidroxila", "O carbono que pertencia √† carbonila e se torna quiral na cicliza√ß√£o", "O carbono ligado ao grupo CH‚ÇÇOH"], correctAnswer: 2 },
                { id: 32, difficulty: 'M√©dia', question: "A quitina, que forma o exoesqueleto de insetos, √© um pol√≠mero de qual tipo de mol√©cula?", topic: "Polissacar√≠deos Estruturais", options: ["Glicose", "Um derivado da glicose", "Frutose", "Galactose"], correctAnswer: 1 },
                { id: 33, difficulty: 'M√©dia', question: "Qual a principal diferen√ßa entre amilose e amilopectina, os componentes do amido?", topic: "Polissacar√≠deos de Reserva", options: ["Amilose √© feita de frutose", "Amilose √© ramificada e amilopectina √© linear", "Amilose √© linear e amilopectina √© ramificada", "N√£o h√° diferen√ßa"], correctAnswer: 2 },
                { id: 34, difficulty: 'M√©dia', question: "A rea√ß√£o de cicliza√ß√£o da D-glicose envolve a rea√ß√£o do grupo alde√≠do (C1) com a hidroxila de qual outro carbono?", topic: "Linear vs. C√≠clica", options: ["C2", "C4", "C5", "C6"], correctAnswer: 2 },
                { id: 35, difficulty: 'M√©dia', question: "Qual dos seguintes √© um oligossacar√≠deo?", topic: "Classifica√ß√£o dos Carboidratos", options: ["Glicose", "Celulose", "Sacarose", "Glicog√™nio"], correctAnswer: 2 },
                { id: 36, difficulty: 'M√©dia', question: "O glicog√™nio √© estruturalmente mais semelhante a qual componente do amido?", topic: "Polissacar√≠deos de Reserva", options: ["Amilose", "Amilopectina", "Ambos", "Nenhum"], correctAnswer: 1 },
                { id: 37, difficulty: 'M√©dia', question: "Em uma liga√ß√£o glicos√≠dica Œ≤(1‚Üí4), o 'Œ≤' se refere √† configura√ß√£o de qual carbono?", topic: "A Liga√ß√£o Glicos√≠dica", options: ["Do carbono 1 do primeiro monossacar√≠deo", "Do carbono 4 do segundo monossacar√≠deo", "De ambos os carbonos", "Nenhum dos anteriores"], correctAnswer: 0 },
                { id: 38, difficulty: 'M√©dia', isGraphic: true, question: "Qual imagem representa o an√¥mero Œ≤ da D-Glicopiranose?", topic: "Isomeria: An√¥meros (Œ± e Œ≤)", options: ["A imagem da esquerda", "A imagem da direita", "Ambas", "Nenhuma"], correctAnswer: 1, imageName: "alpha-beta.jpg" },
                { id: 39, difficulty: 'M√©dia', isGraphic: true, question: "A D-Manose (√† esquerda) e a D-Glicose (ao centro) s√£o ep√≠meros em qual carbono?", topic: "Isomeria: Ep√≠meros", options: ["C2", "C3", "C4", "C5"], correctAnswer: 0, imageName: "epimero.jpg" },
                { id: 40, difficulty: 'M√©dia', question: "A forma c√≠clica de uma cetose √© chamada de:", topic: "Linear vs. C√≠clica", options: ["Hemicetal", "Hemiacetal", "Aldol", "Cetol"], correctAnswer: 0 },

                // --- DIF√çCIL: 20 quest√µes ---
                { id: 41, difficulty: 'Dif√≠cil', question: "Qual a diferen√ßa estrutural entre o glicog√™nio e a amilopectina?", topic: "Polissacar√≠deos de Reserva", options: ["O glicog√™nio tem liga√ß√µes Œ≤", "A amilopectina n√£o √© ramificada", "O glicog√™nio √© mais intensamente ramificado que a amilopectina", "N√£o h√° diferen√ßa"], correctAnswer: 2 },
                { id: 42, difficulty: 'Dif√≠cil', question: "Se a D-Manose e a D-Galactose s√£o ambas ep√≠meros da D-Glicose, elas s√£o ep√≠meros entre si?", topic: "Isomeria: Ep√≠meros", options: ["Sim, em C2 e C4", "N√£o, porque elas diferem na configura√ß√£o de mais de um carbono quiral", "Sim, apenas em C3", "Apenas se estiverem na forma c√≠clica"], correctAnswer: 1 },
                { id: 43, difficulty: 'Dif√≠cil', question: "Uma liga√ß√£o glicos√≠dica Œ±(1‚Üí6) √© respons√°vel por qual caracter√≠stica estrutural no glicog√™nio e na amilopectina?", topic: "Polissacar√≠deos de Reserva", options: ["A linearidade da cadeia", "A forma√ß√£o de dupla h√©lice", "Os pontos de ramifica√ß√£o na cadeia", "A liga√ß√£o com prote√≠nas"], correctAnswer: 2 },
                { id: 44, difficulty: 'Dif√≠cil', isGraphic: true, question: "Na Œ≤-D-Glicopiranose, como est√° a orienta√ß√£o da hidroxila (-OH) do C1 em rela√ß√£o ao grupo -CH‚ÇÇOH do C5?", topic: "Isomeria: An√¥meros (Œ± e Œ≤)", options: ["Na mesma dire√ß√£o (cis)", "Em dire√ß√µes opostas (trans)", "A 90 graus", "N√£o h√° rela√ß√£o"], correctAnswer: 0, imageName: "alpha-beta.jpg" },
                { id: 45, difficulty: 'Dif√≠cil', question: "A sacarose √© considerada um a√ß√∫car n√£o-redutor. Por qu√™?", topic: "Dissacar√≠deos Comuns", options: ["Porque √© muito doce", "Porque a liga√ß√£o glicos√≠dica envolve os carbonos anom√©ricos de ambas as unidades", "Porque ela n√£o pode ser digerida", "Porque √© um pol√≠mero muito longo"], correctAnswer: 1 },
                { id: 46, difficulty: 'Dif√≠cil', isGraphic: true, question: "A D-Manose e a D-Glicose, mostradas na figura, diferem na estereoqu√≠mica de qual carbono?", topic: "Isomeria: Ep√≠meros", options: ["C4", "C3", "C2", "C5"], correctAnswer: 2, imageName: "epimero.jpg" },
                { id: 47, difficulty: 'Dif√≠cil', question: "A estrutura r√≠gida e fibrosa da celulose √© resultado de qual caracter√≠stica molecular?", topic: "Polissacar√≠deos Estruturais", options: ["Das muitas ramifica√ß√µes na cadeia", "Das liga√ß√µes Œ±(1‚Üí4) que formam h√©lices", "Das liga√ß√µes Œ≤(1‚Üí4) que formam cadeias retas e das pontes de hidrog√™nio entre elas", "Da alta solubilidade em √°gua"], correctAnswer: 2 },
                { id: 48, difficulty: 'Dif√≠cil', question: "A qual classe de carboidratos pertence a rafinose, um trissacar√≠deo encontrado em vegetais?", topic: "Classifica√ß√£o dos Carboidratos", options: ["Monossacar√≠deo", "Dissacar√≠deo", "Oligossacar√≠deo", "Polissacar√≠deo"], correctAnswer: 2 },
                { id: 49, difficulty: 'Dif√≠cil', question: "A unidade monom√©rica que forma a quitina √© a N-acetilglicosamina, que √© um derivado de qual monossacar√≠deo?", topic: "Polissacar√≠deos Estruturais", options: ["Glicose", "Frutose", "Galactose", "Manose"], correctAnswer: 0 },
                { id: 50, difficulty: 'Dif√≠cil', question: "Por que a estrutura altamente ramificada do glicog√™nio √© vantajosa para o armazenamento de energia em animais?", topic: "Polissacar√≠deos de Reserva", options: ["Porque ocupa menos espa√ßo na c√©lula", "Porque as ramifica√ß√µes criam muitas extremidades n√£o redutoras, de onde a glicose pode ser liberada rapidamente", "Porque as ramifica√ß√µes tornam a mol√©cula mais sol√∫vel em √°gua", "Porque impede a digest√£o por enzimas"], correctAnswer: 1 },
                { id: 51, difficulty: 'Dif√≠cil', question: "Qual o nome da estrutura c√≠clica de 6 membros formada pela glicose?", topic: "Linear vs. C√≠clica", options: ["Furanose", "Piranose", "Aldose", "Hexose"], correctAnswer: 1 },
                { id: 52, difficulty: 'Dif√≠cil', question: "A intoler√¢ncia √† lactose ocorre devido √† defici√™ncia de uma enzima que quebra qual liga√ß√£o glicos√≠dica?", topic: "Dissacar√≠deos Comuns", options: ["Œ±(1‚Üí4) na maltose", "Œ≤(1‚Üí4) na lactose", "Œ±(1‚Üí2) na sacarose", "Œ≤(1‚Üí4) na celulose"], correctAnswer: 1 },
                { id: 53, difficulty: 'Dif√≠cil', question: "O processo de interconvers√£o entre os an√¥meros Œ± e Œ≤ em solu√ß√£o √© chamado de:", topic: "Isomeria: An√¥meros (Œ± e Œ≤)", options: ["Mutarrota√ß√£o", "Epimeriza√ß√£o", "Hidr√≥lise", "Glicosila√ß√£o"], correctAnswer: 0 },
                { id: 54, difficulty: 'Dif√≠cil', question: "Em qual das seguintes mol√©culas as liga√ß√µes Œ≤-glicos√≠dicas s√£o predominantes?", topic: "A Liga√ß√£o Glicos√≠dica", options: ["Amido", "Glicog√™nio", "Celulose", "Maltose"], correctAnswer: 2 },
                { id: 55, difficulty: 'Dif√≠cil', question: "Qual caracter√≠stica permite que a celulose forme fibras longas e resistentes?", topic: "Polissacar√≠deos Estruturais", options: ["Sua estrutura ramificada", "A capacidade de formar pontes de hidrog√™nio intercadeias", "Sua alta solubilidade em √°gua", "A presen√ßa de liga√ß√µes Œ±(1‚Üí6)"], correctAnswer: 1 },
                { id: 56, difficulty: 'Dif√≠cil', question: "A qual carbono o grupo fosfato se liga na desoxirribose para formar o esqueleto do DNA?", topic: "Fun√ß√µes Biol√≥gicas", options: ["C1' e C2'", "C2' e C3'", "C3' e C5'", "C1' e C4'"], correctAnswer: 2 },
                { id: 57, difficulty: 'Dif√≠cil', isGraphic: true, question: "A D-Galactose (√† direita) √© um ep√≠mero C4 da D-Glicose. Onde a hidroxila do C4 est√° na D-Glicose?", topic: "Isomeria: Ep√≠meros", options: ["Para a direita", "Para a esquerda", "Para cima", "Para baixo"], correctAnswer: 0, imageName: "epimero.jpg" },
                { id: 58, difficulty: 'Dif√≠cil', isGraphic: true, question: "Qual √© a principal diferen√ßa entre o an√¥mero Œ± (esquerda) e o an√¥mero Œ≤ (direita) mostrados na imagem?", topic: "Isomeria: An√¥meros (Œ± e Œ≤)", options: ["A posi√ß√£o do grupo -OH no carbono 2", "A posi√ß√£o do grupo -OH no carbono 1", "A posi√ß√£o do grupo -CH‚ÇÇOH", "O tipo de anel formado"], correctAnswer: 1, imageName: "alpha-beta.jpg" },
                { id: 59, difficulty: 'Dif√≠cil', isGraphic: true, question: "A rea√ß√£o mostrada para formar a maltose libera qual pequena mol√©cula?", topic: "Dissacar√≠deos Comuns", options: ["CO‚ÇÇ", "O‚ÇÇ", "H‚ÇÇO", "CH‚ÇÑ"], correctAnswer: 2, imageName: "Liga√ß√£o glicos√≠dica.jpg" },
                { id: 60, difficulty: 'Dif√≠cil', isGraphic: true, question: "Observando a forma linear da glicose, qual carbono √© o grupo alde√≠do?", topic: "Linear vs. C√≠clica", options: ["C1", "C2", "C5", "C6"], correctAnswer: 0, imageName: "glicose.jpg" },
            ];

            const startBtn = document.getElementById('quiz-start-btn');
            const restartBtn = document.getElementById('restart-quiz-btn');
            const quizContainer = document.getElementById('quiz-container');
            const resultsContainer = document.getElementById('quiz-results');
            const questionEl = document.getElementById('quiz-question');
            const optionsEl = document.getElementById('quiz-options');
            const questionCounterDisplay = document.getElementById('question-counter-display');
            const progressBarFill = document.getElementById('progress-bar-fill');
            const progressLabel = document.getElementById('progress-label');
            const timerDisplay = document.getElementById('timer-display');
            
            let currentQuestionIndex = 0;
            let score = 0;
            let missedTopics = [];
            let activeQuiz = [];
            let correctlyAnsweredIds = [];

            let questionTimer;
            let countdownInterval;
            const TIMER_DURATION = 30; // seconds

            function loadProgress() {
                const savedProgress = localStorage.getItem('carbquiz_correctlyAnsweredIds');
                correctlyAnsweredIds = savedProgress ? JSON.parse(savedProgress) : [];
                updateProgressBar();
            }

            function saveProgress() {
                localStorage.setItem('carbquiz_correctlyAnsweredIds', JSON.stringify(correctlyAnsweredIds));
            }

            function updateProgressBar() {
                const totalQuestions = questionBank.length;
                const answeredCount = correctlyAnsweredIds.length;
                const percentage = totalQuestions > 0 ? Math.round((answeredCount / totalQuestions) * 100) : 0;
                
                progressBarFill.style.width = `${percentage}%`;
                progressBarFill.textContent = `${percentage}%`;
                progressLabel.textContent = `Progresso: ${answeredCount} de ${totalQuestions} quest√µes dominadas`;
            }
            
            function startQuiz() {
                const availableQuestions = questionBank.filter(q => !correctlyAnsweredIds.includes(q.id));
                
                if (availableQuestions.length === 0) {
                     resultsContainer.classList.remove('hidden');
                     quizContainer.classList.add('hidden');
                     startBtn.classList.add('hidden');
                     document.getElementById('quiz-percentage').textContent = "100%";
                     document.getElementById('stat-correct-count').textContent = `‚úîÔ∏è ${questionBank.length} Acertos`;
                     document.getElementById('stat-incorrect-count').textContent = `‚ùå 0 Erros`;
                     document.getElementById('missed-topics-list').innerHTML = '<li class="text-green-600 font-semibold">Parab√©ns! Voc√™ dominou todas as quest√µes.</li>';
                     return;
                }
                
                activeQuiz = [...availableQuestions].sort(() => 0.5 - Math.random()).slice(0, 15);
                
                currentQuestionIndex = 0;
                score = 0;
                missedTopics = [];
                startBtn.classList.add('hidden');
                resultsContainer.classList.add('hidden');
                quizContainer.classList.remove('hidden');
                showQuestion();
            }

            function startTimer() {
                clearTimeout(questionTimer);
                clearInterval(countdownInterval);

                let timeLeft = TIMER_DURATION;
                timerDisplay.textContent = timeLeft;
                timerDisplay.className = 'absolute top-10 left-10 w-11 h-11 rounded-full bg-white/40 border-2 border-slate-600 flex items-center justify-center text-base font-bold text-slate-800 transition-all duration-300 ease-in-out'; // Reset classes
                
                countdownInterval = setInterval(() => {
                    timeLeft--;
                    timerDisplay.textContent = timeLeft;
                    if (timeLeft <= 10 && timeLeft > 5) {
                        timerDisplay.classList.add('warning');
                    } else if (timeLeft <= 5) {
                        timerDisplay.classList.add('danger');
                    }
                }, 1000);

                questionTimer = setTimeout(() => {
                    clearInterval(countdownInterval);
                    handleTimeUp();
                }, TIMER_DURATION * 1000);
            }

            function handleTimeUp() {
                 selectAnswer(null); 
            }

            function showQuestion() {
                resetState();
                if (currentQuestionIndex >= activeQuiz.length) {
                    showResults();
                    return;
                }
                const questionData = activeQuiz[currentQuestionIndex];
                
                questionCounterDisplay.textContent = `${currentQuestionIndex + 1}/${activeQuiz.length}`;
                questionCounterDisplay.classList.remove('facil-bg', 'media-bg', 'dificil-bg');
                if (questionData.difficulty === 'F√°cil') questionCounterDisplay.classList.add('facil-bg');
                else if (questionData.difficulty === 'M√©dia') questionCounterDisplay.classList.add('media-bg');
                else if (questionData.difficulty === 'Dif√≠cil') questionCounterDisplay.classList.add('dificil-bg');

                if (questionData.isGraphic) {
                    const topicId = `topic-${questionData.topic.toLowerCase().replace(/:/g, '').replace(/ /g, '-')}`;
                    const topicCard = document.getElementById(topicId);
                    if(topicCard){
                        const imageElement = topicCard.querySelector(`img[src*="${questionData.imageName}"]`); 
                        if (imageElement) {
                            const clonedImage = imageElement.cloneNode(true);
                            clonedImage.className = 'quiz-question-image mx-auto mb-6 bg-white/40 rounded-lg p-2 max-w-[400px]';
                            questionEl.parentNode.insertBefore(clonedImage, questionEl);
                        }
                    }
                }

                questionEl.textContent = questionData.question;
                
                questionData.options.forEach((option, index) => {
                    const li = document.createElement('li');
                    li.textContent = option;
                    li.classList.add('quiz-option');
                    li.dataset.index = index;
                    li.addEventListener('click', selectAnswer);
                    optionsEl.appendChild(li);
                });
                startTimer();
            }

            function resetState() {
                clearTimeout(questionTimer);
                clearInterval(countdownInterval);
                const existingImage = quizContainer.querySelector('.quiz-question-image');
                if (existingImage) existingImage.remove();
                while(optionsEl.firstChild) {
                    optionsEl.removeChild(optionsEl.firstChild);
                }
                document.body.classList.remove('correct-bg', 'incorrect-bg');
            }
            
            function selectAnswer(e) {
                clearTimeout(questionTimer);
                clearInterval(countdownInterval);

                const selectedOption = e ? e.target : null;
                Array.from(optionsEl.children).forEach(option => option.removeEventListener('click', selectAnswer));

                const currentQuestion = activeQuiz[currentQuestionIndex];
                const correctIndex = currentQuestion.correctAnswer;
                let isCorrect = false;

                if(selectedOption && parseInt(selectedOption.dataset.index) === correctIndex) {
                    isCorrect = true;
                }
                
                Array.from(optionsEl.children).forEach((optionNode, index) => {
                    optionNode.classList.add('disabled');
                    if (index === correctIndex) optionNode.classList.add('correct-answer');
                });

                if (isCorrect) {
                    score++;
                    if(selectedOption) selectedOption.classList.add('correct-answer');
                    document.body.classList.add('correct-bg');
                    if (!correctlyAnsweredIds.includes(currentQuestion.id)) {
                        correctlyAnsweredIds.push(currentQuestion.id);
                        saveProgress();
                        updateProgressBar();
                    }
                } else {
                    if (selectedOption) selectedOption.classList.add('incorrect-answer');
                    missedTopics.push(currentQuestion.topic);
                    document.body.classList.add('incorrect-bg');
                }

                setTimeout(() => {
                    currentQuestionIndex++;
                    if(currentQuestionIndex < activeQuiz.length) {
                        showQuestion();
                    } else {
                        showResults();
                    }
                }, 2500); 
            }
            
            function showResults() {
                resetState();
                quizContainer.classList.add('hidden');
                resultsContainer.classList.remove('hidden');

                const percentage = activeQuiz.length > 0 ? Math.round((score / activeQuiz.length) * 100) : 0;
                document.getElementById('quiz-percentage').textContent = `${percentage}%`;
                document.getElementById('stat-correct-count').textContent = `‚úîÔ∏è ${score} Acertos`;
                document.getElementById('stat-incorrect-count').textContent = `‚ùå ${activeQuiz.length - score} Erros`;
                
                const missedListEl = document.getElementById('missed-topics-list');
                missedListEl.innerHTML = '';
                
                if (missedTopics.some(t => t)) {
                     const uniqueMissedTopics = [...new Set(missedTopics.filter(t => t))];
                     uniqueMissedTopics.forEach(topicName => {
                         const targetCard = Array.from(document.querySelectorAll('.topic-card .summary'))
                             .find(s => s.textContent.trim() === topicName)?.parentElement;

                         if (targetCard) {
                             const bubble = document.createElement('li');
                             bubble.textContent = topicName;
                             bubble.classList.add('missed-topic-bubble');

                             bubble.addEventListener('click', (e) => {
                                 e.currentTarget.classList.add('visited-topic');
                                 targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                 if (!targetCard.classList.contains('is-open')) toggleAccordion(targetCard);
                             });
                             missedListEl.appendChild(bubble);
                         }
                     });
                } else if (activeQuiz.length > 0 && score === activeQuiz.length) {
                     const congrats = document.createElement('li');
                     congrats.textContent = "Parab√©ns, voc√™ acertou tudo!";
                     congrats.classList.add('text-green-600', 'font-semibold');
                     missedListEl.appendChild(congrats);
                }
            }

            startBtn.addEventListener('click', startQuiz);
            restartBtn.addEventListener('click', startQuiz);

            loadProgress();
        });
    </script>
</body>
</html>